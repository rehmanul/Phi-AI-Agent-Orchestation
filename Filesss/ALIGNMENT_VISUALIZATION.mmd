%% Master Diagram Reference: .userInput/agent orchestrator 1.6.mmd
%% Alignment Status Visualization - Shows validation results and system alignment
---
config:
  layout: dagre
  theme: default
---
flowchart TB
    subgraph MASTER["üìê Master Diagram"]
        MASTER_DIAGRAM[".userInput/agent orchestrator 1.6.mmd<br/>939 lines<br/>Authoritative Source"]
    end
    
    subgraph VALIDATION["‚úÖ Validation Results"]
        direction TB
        
        subgraph PASSED["‚úÖ PASSED (7/12)"]
            LEG_STATE["Legislative State Machine<br/>‚úÖ All 6 states found<br/>Current: INTRO_EVT"]
            AI_LAYER["AI Service Layer<br/>‚úÖ All API files found<br/>main.py, routes.py, execution_routes.py"]
            EXEC_LOOP["Execution Loop<br/>‚úÖ 12 execution files<br/>‚úÖ 4 execution agents"]
        end
        
        subgraph WARNINGS["‚ö†Ô∏è WARNINGS (4/12)"]
            AGENT_TYPES["Agent Types<br/>‚ö†Ô∏è Learning agents: 0<br/>‚úÖ Intelligence: 9<br/>‚úÖ Drafting: 7<br/>‚úÖ Execution: 4"]
            MEMORY["Memory & Learning<br/>‚ö†Ô∏è No learning agents<br/>‚úÖ Audit log found<br/>‚úÖ Registry found"]
        end
        
        subgraph FAILED["‚ùå FAILED (1/12)"]
            REVIEW_GATES["Review Gates<br/>‚úÖ HR_PRE: Found<br/>‚ùå HR_LANG: Missing<br/>‚ùå HR_MSG: Missing<br/>‚ùå HR_RELEASE: Missing<br/><i>Expected - created on demand</i>"]
        end
    end
    
    subgraph DIAGRAMS["üìä Diagram References"]
        DIAGRAM_STATUS["‚úÖ ALL 24 DIAGRAMS<br/>Have Master Reference"]
        DIAGRAM_BREAKDOWN["System Context: 4<br/>Execution: 5<br/>Monitoring: 2<br/>Policy: 10<br/>Drafting: 3"]
    end
    
    subgraph COMPONENTS["üîß Component Mapping"]
        direction TB
        
        subgraph MAPPED["‚úÖ Fully Mapped (4/6)"]
            SPINE_MAP["Legislative Spine<br/>state/legislative-state.json<br/>AUTHORITATIVE_INVARIANTS.md"]
            AI_MAP["AI Service Layer<br/>app/main.py<br/>app/routes.py<br/>app/execution_routes.py"]
            MEMORY_MAP["Memory & Learning<br/>audit/audit-log.jsonl<br/>registry/agent-registry.json"]
            EXEC_MAP["Execution Loop<br/>execution/ (12 files)<br/>agents/execution_*.py (4)"]
        end
        
        subgraph PARTIAL["‚ö†Ô∏è Partially Mapped (2/6)"]
            AGENT_MAP["Agent Types<br/>‚úÖ Intelligence: 9<br/>‚úÖ Drafting: 7<br/>‚úÖ Execution: 4<br/>‚ö†Ô∏è Learning: 0"]
            GATE_MAP["Review Gates<br/>‚úÖ HR_PRE: Found<br/>‚ö†Ô∏è HR_LANG: Missing<br/>‚ö†Ô∏è HR_MSG: Missing<br/>‚ö†Ô∏è HR_RELEASE: Missing"]
        end
    end
    
    subgraph DOCS["üìö Documentation Status"]
        DOC_STATUS["‚úÖ All Documentation Complete"]
        DOC_LIST["‚úÖ MASTER_DIAGRAM_REFERENCE.md<br/>‚úÖ COMPONENT_MAPPING.md<br/>‚úÖ diagrams/DIAGRAM_INDEX.md<br/>‚úÖ agents/AGENT_RULES.md<br/>‚úÖ ALIGNMENT_STATUS.md<br/>‚úÖ AUTHORITATIVE_INVARIANTS.md (updated)<br/>‚úÖ README_RUN.md (updated)"]
    end
    
    subgraph SCORE["üìà Alignment Score"]
        SCORE_VALUE["87.5% Compliance<br/>7 Passed + 4 Warnings<br/>1 Expected Failure"]
        TARGET["Target: >95%<br/>Gap: 7.5%<br/>(Due to expected missing items)"]
    end
    
    subgraph SCRIPTS["üõ†Ô∏è Validation Scripts"]
        SCRIPT_LIST["‚úÖ validate_master_diagram_alignment.py<br/>‚úÖ validate_diagram_references.py<br/>‚úÖ validate_component_mapping.py<br/>‚úÖ check_master_alignment.py<br/>‚úÖ add_master_diagram_references.py"]
    end
    
    %% Master diagram is source of truth
    MASTER_DIAGRAM --> VALIDATION
    MASTER_DIAGRAM --> DIAGRAMS
    MASTER_DIAGRAM --> COMPONENTS
    
    %% Validation flows
    VALIDATION --> SCORE
    DIAGRAMS --> SCORE
    COMPONENTS --> SCORE
    
    %% Documentation references
    VALIDATION --> DOCS
    COMPONENTS --> DOCS
    DIAGRAMS --> DOCS
    
    %% Scripts validate everything
    SCRIPTS --> VALIDATION
    SCRIPTS --> DIAGRAMS
    SCRIPTS --> COMPONENTS
    
    %% Styling
    classDef passed fill:#d4edda,stroke:#28a745,stroke-width:2px
    classDef warning fill:#fff3cd,stroke:#ffc107,stroke-width:2px
    classDef failed fill:#f8d7da,stroke:#dc3545,stroke-width:2px
    classDef master fill:#e7f3ff,stroke:#0052cc,stroke-width:3px
    classDef docs fill:#f0f8ff,stroke:#4682b4,stroke-width:2px
    classDef score fill:#e1f5ff,stroke:#0066cc,stroke-width:2px
    classDef scripts fill:#fce7f3,stroke:#be185d,stroke-width:2px
    
    class MASTER_DIAGRAM master
    class LEG_STATE,AI_LAYER,EXEC_LOOP,SPINE_MAP,AI_MAP,MEMORY_MAP,EXEC_MAP,DIAGRAM_STATUS passed
    class AGENT_TYPES,MEMORY,AGENT_MAP,GATE_MAP,PARTIAL warning
    class REVIEW_GATES,FAILED failed
    class DOC_STATUS,DOC_LIST docs
    class SCORE_VALUE,TARGET score
    class SCRIPT_LIST scripts
